<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Analisi dei dati con Pandas | Informatica insieme</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Analisi dei dati con Pandas" />
<meta name="author" content="fabio" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Pandas è una libreria Python focalizzata sulla manipolazione e l’analisi dei dati. I dati sono la colonna portante di tutta la teoria dell’informazione e **Pandas** si rivela spesso una risorsa preziosa." />
<meta property="og:description" content="Pandas è una libreria Python focalizzata sulla manipolazione e l’analisi dei dati. I dati sono la colonna portante di tutta la teoria dell’informazione e **Pandas** si rivela spesso una risorsa preziosa." />
<link rel="canonical" href="http://localhost:4000/informaticainsieme/pandas/analisi-dei-dati-con-pandas" />
<meta property="og:url" content="http://localhost:4000/informaticainsieme/pandas/analisi-dei-dati-con-pandas" />
<meta property="og:site_name" content="Informatica insieme" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-09-15T08:04:41+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Analisi dei dati con Pandas" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"fabio"},"dateModified":"2021-09-15T08:04:41+02:00","datePublished":"2021-09-15T08:04:41+02:00","description":"Pandas è una libreria Python focalizzata sulla manipolazione e l’analisi dei dati. I dati sono la colonna portante di tutta la teoria dell’informazione e **Pandas** si rivela spesso una risorsa preziosa.","headline":"Analisi dei dati con Pandas","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/informaticainsieme/pandas/analisi-dei-dati-con-pandas"},"url":"http://localhost:4000/informaticainsieme/pandas/analisi-dei-dati-con-pandas"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/informaticainsieme/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/informaticainsieme/feed.xml" title="Informatica insieme" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/informaticainsieme/">Informatica insieme</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/informaticainsieme/about/">About me</a><a class="page-link" href="/informaticainsieme/paginemenu/codifica.html">La codifica dell&#39;informazione</a><a class="page-link" href="/informaticainsieme/paginemenu/python.html">Python</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Analisi dei dati con Pandas</h1>
  </header>

  <div class="post-content">
    <p>Pandas è una libreria Python focalizzata sulla manipolazione e l’analisi dei dati. I dati sono la colonna portante di tutta la teoria dell’informazione e <strong><a href="https://pandas.pydata.org/">**Pandas**</a></strong> si rivela spesso una risorsa preziosa.</p>

<h1 id="perché-pandas">Perché Pandas?</h1>

<p><strong><a href="https://pandas.pydata.org/">**Pandas**</a></strong> è una libreria open-source scritta in Python fondata su <a href="https://numpy.org/">NumPy</a> (una libreria Python per il calcolo scientifico) ed ha molte funzionalità per pulire analizzare e manipolare i dati. Lo scopo è quello di estrarre conoscenza dai dati grezzi.</p>

<p>La struttura principale in The main data structure in <strong><em><a href="https://pandas.pydata.org/">**Pandas**</a></em></strong> è una tabella bidimensioinale chiamata <strong>DataFrame</strong>. Si possono creare dataframe a partire da vari formati come <em>CSV</em>, <em>XLSX</em>, <em>JSON</em>, <em>SQL</em>.</p>

<h1 id="iniziamo">Iniziamo</h1>

<p>Come prima cosa dobbiamo istallare <em>Pandas.</em> Ci sono molti ambienti in cui possiamo utilizzarlo. La cosa più semplice da fare è istallare <a href="https://www.anaconda.com/">Anaconda</a>, una distribuzione di software che mira a coprire tutti i bisogni del calcolo scientifico con centinaia di pacchetti preistallati. Anaconda può essere istallata su Windows, macOS, e Linux.</p>

<p>Ad ogni modo forse la cosa più semplice è utilizzare il proprio browser con <a href="https://jupyter.org/">Jupyter Notebook</a> nel cloud. Si può utilizzare <a href="https://www.ibm.com/cloud/watson-studio">IBM Watson Studio</a> oppure <a href="https://colab.research.google.com/">Google Colab</a>. Entrambi si possono utilizzare gratis e vengono forniti con centinaia di pacchetti Python preistallati.</p>

<p>Negli esempi utilizzeremo <strong>Google Colab</strong> perché molto semplice da utilizzare e non ha bisogno di istallazione.</p>

<h2 id="istallazione-ed-importazione">Istallazione ed importazione</h2>

<p>Al fine di istallare Pandas sul proprio sistema possiamo utilizzare il gestore nativo di pacchetti Python: pip.</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">pip install pandas</code></pre></figure>

<p>&lt;/div&gt;oppure</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">conda install pandas</code></pre></figure>

<p>&lt;/div&gt;Nota che se stai usando Google Colab non avrai bisogno di dare questi comandi dati che Pandas è preistallato.</p>

<p>Per utilizzare la libreria Pandas all’interno di uno script scriviamo:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">import pandas as pd</code></pre></figure>

<p>&lt;/div&gt;Di solito Pandas viene importato come “pd” per brevità, in modo da non dever scrivere il nome per intero ogni volta che lo si utilizza.</p>

<h1 id="pandas-dataframe">Pandas DataFrame</h1>

<p>Dopo che abbiamo istallato ed importato <em>Pandas</em>, vediamo come fare per leggere un file e creare un <strong>Pandas DataFrame</strong>. I dati su cui lavoreremo sono una versione semplificata di una competizione <a href="https://www.kaggle.com/c/home-data-for-ml-course/overview">Kaggle</a> che riguarda i prezzi delle case.</p>

<p>Il file che contiene i dati è un file di tipo <strong>.CSV</strong> (Comma-separated values) che potete trovare <a href="http://esercizidiinformatica.it/daticase.csv">qui</a>.</p>

<h2 id="leggere-il-file-e-creare-il-dataframe">Leggere il file e creare il DataFrame</h2>

<p>A fine di leggere il file e inserire i dati in questo contenuti all’interno di un DataFrame untilizziamo il comando read_csv.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="n">PATH</span> <span class="o">=</span> <span class="s">'https://www.esercizidiinformatica.it/daticase.csv'</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">PATH</span><span class="p">)</span></code></pre></figure>

<p>&lt;/div&gt;Abbiamo utilizzato il metodo <em>read_csv</em> perché stiamo lavorando con un file csv. Come abbiamo detto prima PANDAS può lavorare con diversi formati di file. Si rimanda alla <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/io.html">documentazione</a> per vedere quali.</p>

<p>Il medoto <em>read_csv</em> carica in memoria il contenuto di un file e crea un DataFame ma se vogliamo creare un DataFrame a partire da una truttura dati base di Python come <strong>dizionari</strong>, <strong>liste</strong>, <strong>NumPy Array</strong>, o perfino un altro <strong>DataFrame</strong>, potete usare il costruttore della classe DataFrame in questo modo:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mydict</span><span class="p">)</span></code></pre></figure>

<p>&lt;/div&gt;Controlliamo il tipo di Dataframe che abbiamo appena creato:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="nb">type</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code></pre></figure>

<p>&lt;/div&gt;<figure class="wp-block-image"><img src="https://miro.medium.com/max/514/1*8OHeUqQ5rZxzPxdCNpMo1Q.png" alt="" /></figure># Esaminiamo il DataFrame</p>

<p>Diamo una prima occhiata al DataFrame. Possiamo controllare le prime <em>n</em> righe del file appena caricato con il metodo <em>head</em>. Se <em>n</em> non viene specificato si applica il valore di default pari a 5.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">.</span><span class="n">head</span><span class="p">()</span></code></pre></figure>

<p>&lt;/div&gt;<figure class="wp-block-image"><img src="https://miro.medium.com/max/2000/1*P9dcG0lJvmZlftEp2mmRPg.png" alt="" /></figure>Ad un prima occhiata tutto sembra in ordine. Possiamo allo stesso modo usare il metodo tail per vedere le ultime 5 righe del file:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">.</span><span class="n">tail</span><span class="p">()</span></code></pre></figure>

<p>&lt;/div&gt;<figure class="wp-block-image"><img src="https://miro.medium.com/max/2000/1*gv18jwruP61WZ4XLNd89ag.png" alt="" /></figure>Ora controlliamo le dimensione del nostro DataFrame stampando l’attributo <em>shape</em>.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">.</span><span class="n">shape</span></code></pre></figure>

<p>&lt;/div&gt;<figure class="wp-block-image"><img src="https://miro.medium.com/max/260/1*7qFdFOwoju3_MNxemilRdg.png" alt="" /></figure>Viene restituita una tupla contenente il numero delle righe e delle colonne del nostro Dataframe. Nel nostro caso 1,460 righe e 16 colonne o <strong>features</strong> (caratteristiche)</p>

<p>Possiamo vedere un sommario del Dataframe con il metodo <em>info</em>.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">.</span><span class="n">info</span><span class="p">()</span></code></pre></figure>

<p>&lt;/div&gt;<figure class="wp-block-image"><img src="https://miro.medium.com/max/772/1*dYOOxU-MzmUojyKhi6TQnQ.png" alt="" /></figure>Vengono mostrate informazioni utili sul DataFrame, come i nomi delle colonne, il numero di valori non nulli, i tipi di dato, e la quantità di memoria utilizzata. Possiamo vedere che alcune colonne hanno valori mancanti. Approfondiremo questo aspetto più avanti.</p>

<p>Il metodo describe ci fornisce qualche valore statistico sul Dataframe.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">.</span><span class="n">describe</span><span class="p">()</span></code></pre></figure>

<p>&lt;/div&gt;<figure class="wp-block-image"><img src="https://miro.medium.com/max/1400/1*VN54H9tL-LPMmV2VuYHmmQ.png" alt="" /></figure>Viene mostrato il conteggio dei valori, la media, la mediana, la deviazione standard i valori minimi e massimi e la distribuzione nei quartili per ciascuna colonna o feature. Attenzione si mostrano soltanto dati sulle colonne numeriche.</p>

<p>Vediamo un ultimo metodo prima di spostarci alla prossima sezione: <em>value_counts</em>.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">[</span><span class="s">'Neighborhood'</span><span class="p">].</span><span class="n">value_counts</span><span class="p">()</span></code></pre></figure>

<p>&lt;/div&gt;<figure class="wp-block-image"><img src="https://miro.medium.com/max/752/1*u_E9AjnF59x9_m0Y1tZwOg.png" alt="" /></figure>Questo metodo restituisce una Serie di valori che contiene il numero di valori unici per ciascuna colonna. La si può applicare all’intero DataFrame ma nell’esempio l’abbiamo applicata soltanto alla colonna “Neighborhood”.</p>

<p>Prima di andare avanti cerchiamo di capire con che dati abbiamo a che fare:</p>

<ul>
  <li><em>Id</em> — Identificatore unico per ciascuna riga (indice).</li>
  <li><em>LotArea</em> — Grandezza del parcheggio in piedi quadrati (sono dati americani)</li>
  <li><em>Street</em> — Tipo di accesso alla strada</li>
  <li><em>Neighborhood</em> — Allocazione fisica della casa</li>
  <li><em>HouseStyle</em> — Stile di residenza</li>
  <li><em>YearBuilt</em> — Data di costruione</li>
  <li><em>CentralAir</em> — Aria condizionata centralizzata</li>
  <li><em>BedroomAbvGr</em> — Numero di camere da letto al di sopra del piano terra</li>
  <li><em>Fireplaces</em> — Numero di caminetti</li>
  <li><em>GarageType</em> — Posizione del Garage</li>
  <li><em>GarageYrBlt</em> — Anno di costruzione del garage</li>
  <li><em>GarageArea</em> — Grandezza del garage in piedi quadrati</li>
  <li><em>PoolArea</em> — Grandezza della piscina in piedi quadrati</li>
  <li><em>PoolQC</em> — Qualità della piscina</li>
  <li><em>Fence</em> — Qualità della recinzione</li>
  <li><em>SalePrice</em> — Prezzo di vendita</li>
</ul>

<p>Il nostro dataset contiene dati di diverso tipo: numerici, categorie, booleani.</p>

<p>Ora cominciamo a manipolare il Dataframe.</p>

<h1 id="manipoliamo-i-dati-con-pandas">Manipoliamo i dati con Pandas</h1>

<p><em>Pandas</em> ci fornisce molti strumenti per manipolare i dati. In questa sezione vedremo come manipolare righe e colonne inoltre vedremo come localizzare i dati e modificarli. Iniziamo creando un indice per il nostro DataFrame.</p>

<h2 id="lindice-del-dataframe">L’indice del DataFrame</h2>

<p>Quando abbiamo visualizzato i nostri dati ci siamo accorti che la prima colonna (<strong>Id</strong>) ha un valore unico per ciascuna riga. Noi possiamo avvantaggiarci di questa caratteristica e utilizzare questa colonna come indice al posto dell’indice creato automaticamente durante il caricamento.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">.</span><span class="n">set_index</span><span class="p">(</span><span class="s">'Id'</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">index</span></code></pre></figure>

<p>&lt;/div&gt;<figure class="wp-block-image"><img src="https://miro.medium.com/max/1244/1*3_Fx6w6QClEYV8Hu6TEF2g.png" alt="" /></figure>Durante questa operazione, se poniamo <em>inplace</em> a <em>True</em> andiamo ad aggiornare il DataFrame corrente. Se poniamo <em>inplace = False</em> (valore di default) andremo a creare una copia del DataFrame in cui la colonna Id sarò indice senza modificare il DataFrame di partenza.</p>

<p>Questa operazione può essere fatta anche durante il caricamento del file.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">PATH</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s">'Id'</span><span class="p">)</span></code></pre></figure>

<p>&lt;/div&gt;Vediamo che aspetto ha il nostro DataFrame dopo aver impartito questo comando.</p>

<figure class="wp-block-image">![](https://miro.medium.com/max/2000/1*JB3Jn5Mror4O6ETJt2ijjg.png)</figure>
<p>Ora i dati sono un po’ più puliti!</p>

<h2 id="righe-e-colonne">Righe e colonne</h2>

<p>Come vi siete accorti un DataFrame è una tabella che contiene dati e questa tabella è organizzata in righe e colonne. In <em>Pandas</em>, un singola colonna viene chiamata <em>Serie</em>. E’ possibile vedere l’elenco delle colonne di un DataFrame con il comando seguente.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">.</span><span class="n">columns</span></code></pre></figure>

<p>&lt;/div&gt;<figure class="wp-block-image"><img src="https://miro.medium.com/max/1366/1*R6EWPCNB3oY2_nirL4ZtPg.png" alt="" /></figure></p>
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">[</span><span class="s">'LotArea'</span><span class="p">].</span><span class="n">head</span><span class="p">()</span></code></pre></figure>

<p>&lt;/div&gt;<figure class="wp-block-image"><img src="https://miro.medium.com/max/522/1*_qn-69ByRaMe8E7flm2rQA.png" alt="" /></figure></p>
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="nb">type</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'LotArea'</span><span class="p">])</span></code></pre></figure>

<p>&lt;/div&gt;<figure class="wp-block-image"><img src="https://miro.medium.com/max/488/1*al2CI9DXApHqFPTrd1KmgA.png" alt="" /></figure>Notate che una colonna nel nostro DataFrame è di tipo <em>Series</em>.</p>

<p><strong>Rinominiamo le colonne</strong></p>

<p>E’ molto semplice rinominare le colonne con <em>Pandas</em>. Per esempio prendiamo la feature <em>BedroomAbvGr</em>, e rinominiamola <em>Bedroom</em>.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s">'BedroomAbvGr'</span><span class="p">:</span> <span class="s">'Bedroom'</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></code></pre></figure>

<p>&lt;/div&gt;Si possono rinominare molte colonne con un solo comando basta utilizzare un dizionario che abbia le due chiavi “old names” e “new names” quando si invoca il metodo <em>rename</em>.</p>

<p><strong>Aggiungiamo una colonna</strong></p>

<p>Ci potrebbe essere la necessità di aggiungere una colonna al nostro DataFrame. Vediamo come fare.</p>

<p>Cogliamo l’opportunità per mostrare prima come si crea una copia del DataFrame. Aggiungeremo una colonna alla nostra copia appena crata in modo da non cambiare il DataFrame originale.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df_copy</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_copy</span><span class="p">[</span><span class="s">'Sold'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'N'</span></code></pre></figure>

<p>&lt;/div&gt;Questo è il modo più facile di creare una colonna. Notiamo che abbiamo assegnato il valore <strong>”N”</strong> a tutte le righe della colonna.</p>

<p>Ecco il DataFrame con la nuova colonna.</p>

<figure class="wp-block-image">![](https://miro.medium.com/max/2000/1*Wvqs89iny8w1LZjNMcHg8Q.png)</figure>
<p><strong>Adding rows</strong></p>

<p>Ora supponiamo di avere un DataFrame (<em>df_to_append</em>) che contiene due righe che vogliamo aggiungere a <em>df_copy</em>. Uno dei modi di aggiungere righe alla fine del DataFrame è con il metodo <em>append</em>.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">data_to_append</span> <span class="o">=</span> <span class="p">{</span><span class="s">'LotArea'</span><span class="p">:</span> <span class="p">[</span><span class="mi">9500</span><span class="p">,</span> <span class="mi">15000</span><span class="p">],</span>
                  <span class="s">'Steet'</span><span class="p">:</span> <span class="p">[</span><span class="s">'Pave'</span><span class="p">,</span> <span class="s">'Gravel'</span><span class="p">],</span>
                  <span class="s">'Neighborhood'</span><span class="p">:</span> <span class="p">[</span><span class="s">'Downtown'</span><span class="p">,</span> <span class="s">'Downtown'</span><span class="p">],</span>
                  <span class="s">'HouseStyle'</span><span class="p">:</span> <span class="p">[</span><span class="s">'2Story'</span><span class="p">,</span> <span class="s">'1Story'</span><span class="p">],</span>
                  <span class="s">'YearBuilt'</span><span class="p">:</span> <span class="p">[</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">2019</span><span class="p">],</span>
                  <span class="s">'CentralAir'</span><span class="p">:</span> <span class="p">[</span><span class="s">'Y'</span><span class="p">,</span> <span class="s">'N'</span><span class="p">],</span>
                  <span class="s">'Bedroom'</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                  <span class="s">'Fireplaces'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>     
                  <span class="s">'GarageType'</span><span class="p">:</span> <span class="p">[</span><span class="s">'Attchd'</span><span class="p">,</span> <span class="s">'Attchd'</span><span class="p">],</span>  
                  <span class="s">'GarageYrBlt'</span><span class="p">:</span> <span class="p">[</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">2019</span><span class="p">],</span>
                  <span class="s">'GarageArea'</span><span class="p">:</span> <span class="p">[</span><span class="mi">300</span><span class="p">,</span> <span class="mi">250</span><span class="p">],</span>
                  <span class="s">'PoolArea'</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                  <span class="s">'PoolQC'</span><span class="p">:</span> <span class="p">[</span><span class="s">'G'</span><span class="p">,</span> <span class="s">'G'</span><span class="p">],</span>
                  <span class="s">'Fence'</span><span class="p">:</span> <span class="p">[</span><span class="s">'G'</span><span class="p">,</span> <span class="s">'G'</span><span class="p">],</span> 
                  <span class="s">'SalePrice'</span><span class="p">:</span> <span class="p">[</span><span class="mi">250000</span><span class="p">,</span> <span class="mi">195000</span><span class="p">],</span>
                  <span class="s">'Sold'</span><span class="p">:</span> <span class="p">[</span><span class="s">'Y'</span><span class="p">,</span> <span class="s">'Y'</span><span class="p">]}</span>
<span class="n">df_to_append</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_to_append</span><span class="p">)</span>
<span class="n">df_to_append</span></code></pre></figure>

<p>&lt;/div&gt;<figure class="wp-block-image"><img src="https://miro.medium.com/max/2000/1*ERQa8iLMeun4AqR2c8zTvw.png" alt="" /></figure>Ora aggiungiamo le due righe al DataFrame su <em>df_copy</em>.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">data_to_append</span> <span class="o">=</span> <span class="p">{</span><span class="s">'LotArea'</span><span class="p">:</span> <span class="p">[</span><span class="mi">9500</span><span class="p">,</span> <span class="mi">15000</span><span class="p">],</span>
<span class="n">df_copy</span> <span class="o">=</span> <span class="n">df_copy</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_to_append</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></code></pre></figure>

<p>&lt;/div&gt;Vediamo cosa abbiamo in <em>df_copy</em>:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df_copy</span><span class="p">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span></code></pre></figure>

<p>&lt;/div&gt;<figure class="wp-block-image"><img src="https://miro.medium.com/max/2000/1*ixAB4LFq6M4DGxh_4r7-Dg.png" alt="" /></figure><strong>Rimuoviamo righe e colonne</strong></p>

<p>Al fine di eliminare righe e colonne da un DataFrame, possiamo usar il metodo <em>drop</em>. Immaginiamo di voler cancellare l’ultima riga e le colonna ‘Fence’.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df_copy</span><span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="mi">1461</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">df_copy</span><span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="s">'Fence'</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></code></pre></figure>

<p>&lt;/div&gt;La prima istruzione rimuove l’ultima riga, quella con <em>Id</em> = 1461. E’ possibile rimuoovere più di una riga con una sola chiamata fornendo una lista di indici come argomento.</p>

<p>Ponendo axis=0 (valore di default) chiediamo di rimuovere una riga. Se volessimo rimuovere una colonna porremmo axis=1.</p>

<h2 id="accedere-ai-dati-con-loc-e-iloc">Accedere ai dati con loc e iloc</h2>

<p>Uno dei modi più semplici per accedere ai dati è attraverso i metodi <em>loc</em> e <em>iloc</em>.</p>

<p><em>loc</em> è utilizzato per accedeere alle righe e alle colonne attraverso etichetta (label) e indice oppure basandosi su di un array booleano. Immaginiamo di voler accedere alla riga con indice 1000.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1000</span><span class="p">]</span></code></pre></figure>

<p>&lt;/div&gt;<figure class="wp-block-image"><img src="https://miro.medium.com/max/504/1*9NP2p7Jxc_3jOS2RG2AicA.png" alt="" /></figure>Il metodo in alto seleziona la riga con indice 1000 e mostra i dati contenuti in questa riga. Possiamo anche selezionare la colonna che vogliamo visualizzare.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="p">[</span><span class="s">'LotArea'</span><span class="p">,</span> <span class="s">'SalePrice'</span><span class="p">]]</span></code></pre></figure>

<p>&lt;/div&gt;<figure class="wp-block-image"><img src="https://miro.medium.com/max/488/1*HkP4eQj1MEPA45KGFapYeg.png" alt="" /></figure>Ora vediamo come possiamo applicare una condizione (o filtro) a <em>loc</em>. Immaginiamo di voler selezionare le case che hanno un prezzo di almeno $600,000.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">'SalePrice'</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">600000</span><span class="p">]</span></code></pre></figure>

<p>&lt;/div&gt;<figure class="wp-block-image"><img src="https://miro.medium.com/max/2000/1*5pI-nxkxeuIL7i84a59b4A.png" alt="" /></figure>Con una semplice riga di codice abbiamo trovato le 4 case che hanno un valore al di sopra di $600,000.</p>

<p><em>iloc</em> viene utilizzato per selezionare dati basandosi sulla loro posizione espressa attraverso gli indici come numeri interi oppure come array di valori booleani. Per esempio se vogliamo selezionnare il dato contenuto nella prima riga alla prima colonna utilizziamo:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span></code></pre></figure>

<p>&lt;/div&gt;<figure class="wp-block-image"><img src="https://miro.medium.com/max/156/1*F3llOmLMIJkYIRWeCwtrxQ.png" alt="" /></figure>Il valore mostrato è il valore contenuto nella colonna <em>LotArea</em> nella riga con <em>ID</em> pari a 1. Ricorda che il conteggio degli indici inizia sempre da zero.</p>

<p>Possiamo anche selezionare una intera riga, in questo caso la riga in posizione 10:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">10</span><span class="p">,:]</span></code></pre></figure>

<p>&lt;/div&gt;<figure class="wp-block-image"><img src="https://miro.medium.com/max/464/1*D9LSuZATAoAIdS26ouTCKQ.png" alt="" /></figure>E possiamo selezionare una intera colonna, per esempio l’ultima:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></code></pre></figure>

<p>&lt;/div&gt;<figure class="wp-block-image"><img src="https://miro.medium.com/max/812/1*h2PDLZ3BMUavq7dlziuq2g.png" alt="" /></figure>Possiamo utilizzare le tecniche di slicing viste per le liste.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span></code></pre></figure>

<p>&lt;/div&gt;<figure class="wp-block-image"><img src="https://miro.medium.com/max/720/1*MByQHdDyG9VMNK8tPyyZJA.png" alt="" /></figure># Gestire i valori mancanti</p>

<p>In un mondo ideale avremmo dati corretti, accurati e completi. Purtrroppo il mondo ideale non esiste. Un problema particolare sono i dati mancanti. Vediamo come Pandas ci viene in aiuto.</p>

<h2 id="cerchiamo-valori-mancanti">Cerchiamo valori mancanti</h2>

<p>Il primo passo consiste nel trovare i valori che sono mancanti nel nostro DataFrame. Utilizziamo il metodo <em>isnull</em>. Questo metodo restituisce un oggetto con la stessa forma del DataFrame originale che contiene i valori True e False per ciascun elemento del DataFrame originale. <em>True</em> apparirà se un valore è mancante, False in caso contrario.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">.</span><span class="n">isnull</span><span class="p">()</span></code></pre></figure>

<p>&lt;/div&gt;<figure class="wp-block-image"><img src="https://miro.medium.com/max/2000/1*6krVxLO-KlplLSGUldJ-PA.png" alt="" /></figure>Nota che non è sempre semplice lavorare con i dati restituiti qui in alto. See stai lavorando con un DataFrame molto piccolo va bene ma se hai milioni di righe è meglio aggregare i valori per colonna come nell’esempio seguente:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">.</span><span class="n">isnull</span><span class="p">().</span><span class="nb">sum</span><span class="p">()</span></code></pre></figure>

<p>&lt;/div&gt;<figure class="wp-block-image"><img src="https://miro.medium.com/max/422/1*1XUaaTXM8fjaGXVvA7fDyQ.png" alt="" /></figure>Ora è molto meglio! Ci possiamo rendere conto dell’accuratezza dei nostri dati. Molte colonne sono complete e queesto va bene. Il metodo <em>sum</em> ha sommato tutti i valori <em>True</em> restituiti da <em>isnull</em> perché questi sono equivalenti a 1. I valori pari a <em>False</em> sono equivalenti a 0.</p>

<p>Possiamo anche calcolare il rapporto tra il numero di valori mancanti e il numero di valori in ciascuna colonna:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">.</span><span class="n">isnull</span><span class="p">().</span><span class="nb">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">df</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></code></pre></figure>

<p>&lt;/div&gt;<figure class="wp-block-image"><img src="https://miro.medium.com/max/486/1*FOiFBAZyQsO05KEPtzmkhg.png" alt="" /></figure>Facciamo un passo avanti e scriviamo un script che calcoli le percentuali dei valori che sono mancanti.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">].</span><span class="n">isnull</span><span class="p">().</span><span class="nb">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="s">': {:.2%}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">].</span><span class="n">isnull</span><span class="p">().</span><span class="nb">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">].</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span></code></pre></figure>

<p>&lt;/div&gt;<figure class="wp-block-image"><img src="https://miro.medium.com/max/382/1*EVO89zxch2olG6HsWVHNaw.png" alt="" /></figure>## Rimuoviamo i valori mancanti</p>

<p>Dopo aver capito quali e quanti sono i valori mancanti dobbiamo decidere cosa fare con questi. Ora vedremo come eliminarli.</p>

<p>Dobbiamo essere molto cauti prima di rimuovere una intera riga o colonna dalla nostra fonte dati perché potremmo danneggiare la nostra analisi.</p>

<p>Iniziamo dalla caratteristica (feature) che si chiama <em>PoolQC</em>. Dato che il 99% dei valori sono mancanti la rimuoveremo. Come abbiamo visto in precedenza possiamo eliminare una colonna intera con il metodo <em>drop</em>.</p>

<p>Utilizzeremo una copia del DataFrame originale.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df_toremove</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span><span class="n">df_toremove</span><span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="s">'PoolQC'</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></code></pre></figure>

<p>&lt;/div&gt;Ora poniamo l’attenzione sulla caratteristica <em>GarageType</em>. Dato che ci sono il 5% di valori mancanti possiamo semplicemente cancellare le righe con valore nullo utilizzando il metodo <em>dropna</em>.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df_toremove</span><span class="p">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s">'GarageType'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></code></pre></figure>

<p>&lt;/div&gt;## Compiliamo i valori mancanti</p>

<p>Quando opertiamo con valori mancanti possiamo pensare di “indovinare” il valore che ci sarebbe stato se non fosse stato mancante. Ci sono molte tecniche che ci aiutano in questo, alcune basate sul machine learning. Per ora vediamo cosa <em>Pandas</em> mette a nostra disposizione a questo fine.</p>

<p>Diamo una prima occhiata alla caratteristica <em>Fence</em>. Abbiamo l’ 80% di valori mancanti. Immaginiamo che sia così perché queste case non hanno la rete (Fence). Basandoci su questo riempiamo tutti i valori mancanti con la stringa <em>NoFence</em>.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df_tofill</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_tofill</span><span class="p">[</span><span class="s">'Fence'</span><span class="p">].</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">'NoFence'</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></code></pre></figure>

<p>&lt;/div&gt;Controlliamo ora la caratteristica <em>GarageYrBlt</em>. In questo esempio vedremo come riempire i valori mancanti con il valore mediano di questa caratteristica.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">garage_median</span> <span class="o">=</span> <span class="n">df_tofill</span><span class="p">[</span><span class="s">'GarageYrBlt'</span><span class="p">].</span><span class="n">median</span><span class="p">()</span>
<span class="n">df_tofill</span><span class="p">.</span><span class="n">fillna</span><span class="p">({</span><span class="s">'GarageYrBlt'</span><span class="p">:</span> <span class="n">garage_median</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></code></pre></figure>

<p>&lt;/div&gt;Questi esempi hanno il solo scopo educativo.</p>

<p>Ci siamo accorti che <em>GarageType</em> e <em>GarageYrBlt</em> hanno 81 valori mancanti. Supposiamo che questo sia dovuto al fatto che queste case non hanno garage. Rimuovere delle righe intere in questo caso di certo non è la cosa più intelligente da fare. In effetti quando <em>GarageType</em> era mancante, era mancante anche <em>GarageYrBlt</em>. Questo mostra l’importanza di saper interpretare i dati con cui si è a contatto.</p>

<p>Abbiamo sempre lavorato con delle copie del DataFrame originale perché non vogliamo rovinare i dati.</p>

<h1 id="visualizzare-i-dati">Visualizzare i dati</h1>

<p>In questa sezione vedremo come visualizzare i dati con <em>Pandas</em>. Vedremo i due tipi di grafico di uso più comune: gli istogrammi e i diagrammi a punti.</p>

<h2 id="istogrammi">Istogrammi</h2>

<p>Gli istogrammi sono molto utili per capire le distribuzioni dei dati. Disegnamo l’istogramma della caratteristica <em>SalePrice</em>, dove l’asse <strong>x</strong> contiene insiemi dei valori divisi in intervalli, e l’asse <strong>y</strong> ci mostra quanto frequenti sono quei valori.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">[</span><span class="s">'SalePrice'</span><span class="p">].</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">'hist'</span><span class="p">)</span></code></pre></figure>

<p>&lt;/div&gt;<figure class="wp-block-image"><img src="https://miro.medium.com/max/812/1*C8hCTPpaKFy_2vJPPiXLaA.png" alt="" /></figure>## Diagrammi a punti</p>

<p>Con i diagrammi a punti possiamo vedere la relazione tra due variabili mostrando i valori su di un piano cartesiano. Mostriamo una caratteristica sull’asse <strong>x</strong> e l’altra sull’asse <strong>y</strong>.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'SalePrice'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">'YearBuilt'</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">'scatter'</span><span class="p">)</span></code></pre></figure>

<p>&lt;/div&gt;<figure class="wp-block-image"><img src="https://miro.medium.com/max/794/1*E-g_jn1qr8ukvEKSHGaIjQ.png" alt="" /></figure>Possiamo vedere che c’è una piccola relazione positiva tra il prezzo di vendita e l’anno di costruzione. Gli edifici più nuovi tendenzialmente si vendono ad un prezzo più alto.</p>

<p>Il metodo <em>plot</em> supporta molti tipi di grafico: a linee, a barre, ad area, a torta, ecc.</p>

<h1 id="salvare-su-file">Salvare su file</h1>

<p>In questa ultima sezione vedremo come salvare il DataFrame lavorato su file.</p>

<p>Per salvare il file in formato <em>csv</em> utilizziamo il metodo <em>to_csv</em> seguito dal nome del file.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">'My_DataFrame.csv'</span><span class="p">)</span></code></pre></figure>

<p>&lt;/div&gt;Il file salvato può essere trovato nella cartella Files in alto a sinistra nella pagina di Google Colab.</p>

<figure class="wp-block-image">![](https://miro.medium.com/max/658/1*sZYDVA8b9mFOJ7tP6Onmyg.png)</figure>
<p>Possiamo anche specificare un percorso in locale sulla nostra macchina:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">'C:/Users/username/Documents/My_DataFrame.csv'</span><span class="p">)</span>   </code></pre></figure>

<p>&lt;/div&gt;<figure class="wp-block-image"><img src="https://miro.medium.com/max/1400/1*lVlFpvldmpluAqkxVrFyfg.jpeg" alt="" /></figure># Conclusioni</p>

<p>Spero che questa pagina abbia aiutato a capire le potenzialità di questa libreria. Con un po’ di pratica manipolare i dati diventerà naturale.</p>

<p><em>Pandas</em> è molto utilizzato nell’ambito della data science. Di solito viene utilizzata per una analisi prelimininare per capire e “aggiustare” i dati.</p>

<p>Probabilmente ci vorrà un po’ di sforzo per imparare ad utilizzarla ma presto diventa un coltellino svizzero essenziale.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/informaticainsieme/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Informatica insieme</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Informatica insieme</li><li><a class="u-email" href="mailto:burattino@gmail.com">burattino@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/fabiomattei"><svg class="svg-icon"><use xlink:href="/informaticainsieme/assets/minima-social-icons.svg#github"></use></svg> <span class="username">fabiomattei</span></a></li><li><a href="https://www.twitter.com/fabiomattei"><svg class="svg-icon"><use xlink:href="/informaticainsieme/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">fabiomattei</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>fare cosa gradita.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
